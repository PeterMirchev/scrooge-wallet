<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Details</title>
    <link rel="stylesheet" href="/css/case-detail.css">
</head>

<aside class="navigation-panel">
    <ul>
        <li><a th:href="@{/home}" class="button">Dashboard</a></li>
        <li><a th:href="@{/wallets}" class="button">Wallets</a></li>
        <li><a th:href="@{/pockets}" class="button">Pockets</a></li>
        <li><a th:href="@{/wallets/transfer}" class="button">Transfer</a></li>
        <li><a th:href="@{/transactions}" class="button">Transactions</a></li>
        <li><a th:href="@{/audit-logs}" class="button">Audit Logs</a></li>
        <li><a th:href="@{/users/account-settings}" class="button">Account Settings</a></li>
        <li><a th:href="@{/support}" class="button">Contact support</a></li>
        <li sec:authorize="hasRole('ADMINISTRATOR')"><a th:href="@{/users}" class="button">All Users</a></li>
        <li sec:authorize="hasRole('ADMINISTRATOR')"><a th:href="@{/cases}" class="button">Cases</a></li>
        <li class="logout-button">
            <form id="logout-form" th:action="@{/logout}" th:method="post">
                <button type="submit" class="button logout">Logout</button>
            </form>
        </li>
    </ul>
</aside>

<body>
<main id="case-detail-content" class="cases-content">
    <h2>Case Details</h2>

    <div class="case-detail">
        <p><strong>Case ID:</strong> <span th:text="${case.id}"></span></p>
        <p><strong>Requester Name:</strong> <span th:text="${case.requesterName}"></span></p>
        <p><strong>Requester Email:</strong> <span th:text="${case.requesterEmail}"></span></p>
        <p><strong>Case Owner:</strong> <span th:text="${case.caseOwner}"></span></p>
        <p><strong>Created On:</strong> <span th:text="${case.createdOn}"></span></p>
        <p><strong>Updated On:</strong> <span th:text="${case.updatedOn}"></span></p>
    </div>

    <form th:action="@{'/cases/' + ${case.id} + '/case-details'}" th:object="${caseUpdateRequest}" th:method="put"
    class="case-detail"
    style="margin-top: 20px;">

    <input type="hidden" name="_method" value="put" />

    <h3>Edit Case</h3>

    <label for="caseName"><strong>Case Title:</strong></label>
    <input type="text" id="caseName" th:field="*{caseName}" />

    <label for="caseDescription"><strong>Case Description:</strong></label>
    <textarea id="caseDescription" rows="5" th:field="*{description}"></textarea>

    <label for="status"><strong>Status:</strong></label>
    <select id="status" th:field="*{status}">
        <option th:each="s : ${T(com.scrooge.model.enums.CaseStatus).values()}"
                th:value="${s}"
                th:text="${s}">
        </option>
    </select>

    <button type="submit">Save Changes</button>
    </form>

    <div class="case-detail" style="margin-top: 30px;">
        <h3>Messages / Comments</h3>

        <div th:if="${#lists.isEmpty(messages)}">
            <p>No messages yet.</p>
        </div>

        <ul th:if="${!#lists.isEmpty(messages)}">
            <li th:each="msg : ${messages}" style="margin-bottom: 15px;">
                <p><strong>Author:</strong> <span th:text="${msg.author}"></span></p>
                <p><strong>Text:</strong> <span th:text="${msg.text}"></span></p>
                <p><strong>Date:</strong> <span th:text="${msg.dateTime}"></span></p>
                <hr/>
            </li>
        </ul>
    </div>

    <form th:action="@{'/cases/' + ${case.id} + '/message'}" th:object="${caseMessageRequest}" th:method="POST"
          class="case-detail"
          style="margin-top: 20px;">
        <label for="text"><strong>Send Message:</strong></label>
        <textarea id="text" rows="5" th:field="*{text}"></textarea>
        <button type="submit">Send Message</button>
    </form>
</main>
</body>
</html>
